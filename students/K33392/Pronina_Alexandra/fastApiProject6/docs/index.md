
---

# Пользовательское API

Это веб-API предоставляет ряд эндпоинтов для работы с пользователями(api.py).

## Регистрация нового пользователя

### `POST /register/`

Регистрирует нового пользователя и добавляет его в базу данных.

**Параметры запроса:**
- `user`: Объект, описывающий нового пользователя. Должен содержать следующие поля:
  - `email`: Электронная почта нового пользователя.
  - `password`: Пароль нового пользователя.

**Пример запроса:**
```json
{
  "user": {
    "email": "example@example.com",
    "password": "examplepassword"
  }
}
```

## Аутентификация пользователя

### `POST /login/`

Аутентифицирует пользователя и генерирует JWT-токен для дальнейшего доступа к API.

**Параметры запроса:**
- `user_credentials`: Объект, содержащий учетные данные пользователя. Должен содержать следующие поля:
  - `email`: Электронная почта пользователя.
  - `password`: Пароль пользователя.

**Пример запроса:**
```json
{
  "email": "example@example.com",
  "password": "examplepassword"
}
```

## Получение информации о текущем пользователе

### `GET /user/`

Получает информацию о текущем аутентифицированном пользователе.

**Требуемые заголовки:**
- `Authorization`: JWT-токен, полученный при аутентификации пользователя.

## Получение списка пользователей

### `GET /users/`

Получает список пользователей из базы данных.

**Параметры запроса:**
- `skip` (необязательный): Целое число, определяющее количество пропускаемых пользователей.
- `limit` (необязательный): Целое число, определяющее максимальное количество пользователей, которые следует вернуть.

**Пример запроса:**
```
/users/?skip=0&limit=10
```

## Изменение пароля текущего пользователя

### `PUT /user/change-password/`

Изменяет пароль текущего пользователя.

**Требуемые заголовки:**
- `Authorization`: JWT-токен, полученный при аутентификации пользователя.

**Параметры запроса:**
- `new_password`: Объект, содержащий новый пароль пользователя. Должен содержать следующие поля:
  - `password`: Новый пароль пользователя.

**Пример запроса:**
```json
{
  "password": "newpassword"
}
```

---


---

# Вспомогательные функции работы с пользователями

Эти функции предназначены для работы с пользователями в базе данных и для аутентификации.

## Получение пользователя по ID

### `def get_user(db: Session, user_id: int) -> models.User`

Получает пользователя из базы данных по его уникальному идентификатору.

**Параметры:**
- `db`: Сессия базы данных SQLAlchemy.
- `user_id`: Уникальный идентификатор пользователя.

## Получение пользователя по адресу электронной почты

### `def get_user_by_email(db: Session, email: str) -> models.User`

Получает пользователя из базы данных по его адресу электронной почты.

**Параметры:**
- `db`: Сессия базы данных SQLAlchemy.
- `email`: Адрес электронной почты пользователя.

## Аутентификация пользователя

### `def authenticate_user(db: Session, email: str, password: str) -> Union[models.User, bool]`

Аутентифицирует пользователя по его адресу электронной почты и паролю.

**Параметры:**
- `db`: Сессия базы данных SQLAlchemy.
- `email`: Адрес электронной почты пользователя.
- `password`: Пароль пользователя.

## Создание нового пользователя

### `def create_user(db: Session, user: schemas.UserCreate) -> models.User`

Создает нового пользователя и добавляет его в базу данных.

**Параметры:**
- `db`: Сессия базы данных SQLAlchemy.
- `user`: Объект, описывающий нового пользователя. Должен содержать следующие поля:
  - `email`: Электронная почта нового пользователя.
  - `password`: Пароль нового пользователя.

## Проверка пароля

### `def verify_password(plain_password: str, hashed_password: str) -> bool`

Проверяет, совпадает ли предоставленный пароль с хэшированным паролем пользователя.

**Параметры:**
- `plain_password`: Пароль в текстовом формате, который нужно проверить.
- `hashed_password`: Хэшированный пароль, с которым нужно сравнить предоставленный пароль.

---

Для функций, отвечающих за подключение к базе данных и инициализацию сессии SQLAlchemy:

---

# Подключение к базе данных

Эти функции обеспечивают подключение к базе данных и инициализацию сессии SQLAlchemy для работы с ней.

## Инициализация базы данных

### `def init_db() -> None`

Инициализирует базу данных, создавая все необходимые таблицы на основе определений моделей.

## Получение сессии SQLAlchemy

### `def get_session() -> Session`

Возвращает сессию SQLAlchemy для работы с базой данных. Эта сессия автоматически закрывается после использования.

---


API для управления пользователями
Это веб-API предоставляет возможности для регистрации пользователей, аутентификации, управления пользователями и смены пароля.

Эндпоинты
Регистрация нового пользователя
Метод: POST
Путь: /register/
Описание: Регистрирует нового пользователя с предоставленными учетными данными.
Аутентификация пользователя
Метод: POST
Путь: /login/
Описание: Аутентифицирует пользователя по предоставленным учетным данным и генерирует JWT-токен для доступа.
Получение информации о текущем пользователе
Метод: GET
Путь: /user/
Описание: Возвращает информацию о текущем аутентифицированном пользователе.
Получение списка пользователей
Метод: GET
Путь: /users/
Описание: Возвращает список пользователей с возможностью пагинации.
Смена пароля текущего пользователя
Метод: PUT
Путь: /user/change-password/
Описание: Позволяет текущему пользователю изменить свой пароль.
Запуск приложения
Для инициализации базы данных при запуске приложения используется событие startup.

Изменения:
Файл содержит реализацию API для веб-приложения с использованием FastAPI. Он обеспечивает взаимодействие с базой данных, обработку запросов от клиентов и выполнение необходимой бизнес-логики. Были добавлены ещё несколько эндпоинтов по теме

Зависимости:

fastapi: Веб-фреймворк для создания API.
sqlalchemy: Библиотека для работы с базами данных.
passlib: Библиотека для хеширования паролей.
dotenv: Библиотека для загрузки переменных окружения из файла .env.

Структура:

Импорты: Импорт всех необходимых модулей и классов.
Настройка переменных окружения: Загрузка переменных окружения из файла .env, включая адрес базы данных.
Объявление маршрутов: Определение различных маршрутов для обработки запросов от клиентов.
Функции обработки запросов: Определение функций, которые обрабатывают запросы от клиентов и взаимодействуют с базой данных.
Функции для работы с базой данных: Определение функций, которые выполняют операции с базой данных (например, создание пользователя, создание поездки и т. д.).
Вспомогательные функции: Определение вспомогательных функций, таких как хеширование паролей и проверка аутентификации пользователя.
Документирование функций: Каждая функция сопровождается комментариями, описывающими ее назначение, входные параметры и возвращаемые значения.

Добавлена загрузка переменных окружения из файла .env с помощью библиотеки dotenv.
Вместо явного указания адреса базы данных в коде теперь используется переменная окружения DATABASE_URL.
Эти изменения повышают безопасность приложения, так как конфиденциальные данные, такие как адрес базы данных, теперь хранятся в защищенном файле .env.

crud.py

Этот файл содержит функции, которые обеспечивают взаимодействие с базой данных. Он реализует операции CRUD (Create, Read, Update, Delete) для различных сущностей вашего приложения, таких как пользователи и поездки. Был объединен с security.py, чтобы избежать кольцевания

Зависимости:

sqlalchemy: Библиотека для работы с базами данных.
Структура файла:

Импорты: Импорт всех необходимых модулей и классов.
Функции CRUD: Определение функций, которые выполняют операции CRUD для различных сущностей вашего приложения.
Документирование функций: Каждая функция сопровождается комментариями, описывающими ее назначение, входные параметры и возвращаемые значения.
Изменения:

Внесены изменения для использования переменных окружения вместо явного указания адреса базы данных в коде.
Каждая функция теперь принимает объект сессии SQLAlchemy в качестве параметра для взаимодействия с базой данных.
Эти изменения повышают безопасность приложения и упрощают его поддержку и масштабирование.

models.py

Этот файл содержит определения моделей данных с использованием SQLModel для вашего приложения. Он описывает структуру и отношения между различными сущностями, такими как пользователи, поездки, отзывы и т. д.

Зависимости:

sqlmodel: Библиотека для работы с моделями данных в стиле SQL с поддержкой отношений.
Структура файла:

Импорты: Импорт всех необходимых модулей и классов.
Определение моделей: Определение классов-моделей для каждой сущности в вашем приложении.
Документирование моделей: Каждая модель сопровождается комментариями, описывающими ее поля и отношения с другими моделями.
Изменения:

Добавлено поле password в модель User для хранения пароля пользователя.
Использованы внешние ключи для установки связей между различными сущностями.
В каждой модели определены соответствующие отношения с другими моделями для обеспечения связности данных.
Эти изменения обеспечивают более гибкую и структурированную организацию данных в вашем приложении, что способствует улучшению его масштабируемости и поддерживаемости.


Вот документация к файлу, который вы предоставили:

schemas.py

Этот файл содержит определения схем данных с использованием Pydantic для вашего веб-приложения. Он описывает структуру данных для различных сущностей, таких как пользователи, поездки и т. д., а также схемы для аутентификации и авторизации.

Зависимости:

pydantic: Библиотека для валидации и сериализации данных в Python.
Структура файла:

Импорты: Импорт всех необходимых модулей и классов из Pydantic.
Определение базовых схем: Определение базовых схем данных для пользователей, поездок и других сущностей.
Определение схем для создания и обновления данных: Определение схем для создания или обновления пользователей, поездок и т. д.
Конфигурация схем: Установка конфигурации для схем, такая как orm_mode, чтобы обеспечить корректное преобразование моделей SQLAlchemy в схемы Pydantic.
Дополнительные схемы: Определение дополнительных схем, таких как схемы для аутентификации, авторизации и токенов.
Изменения:

Внесены изменения в схемы для соответствия новым требованиям и структуре данных вашего приложения.
Установлена конфигурация orm_mode, чтобы обеспечить корректное преобразование моделей SQLAlchemy в схемы Pydantic.
Добавлены новые схемы, такие как OAuth2PasswordRequestForm для работы с OAuth2 и TokenData для представления информации о токене.

