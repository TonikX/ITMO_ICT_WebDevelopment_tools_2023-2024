# Описание 


# Лабораторная работа 3: Упаковка FastAPI приложения в Docker, Работа с источниками данных и Очереди

## Цель
Научиться упаковывать FastAPI приложение в Docker, интегрировать парсер данных с базой данных и вызывать парсер через API и очередь.

Задачи 1 и 2 - задачи на минимум для сдачи - 70% баллов. Задачи 1, 2 и 3 - 100% баллов.

### Подзадача 1: Упаковка FastAPI приложения, базы данных и парсера данных в Docker

Docker — это платформа для разработки, доставки и запуска приложений в контейнерах. Контейнеры позволяют упаковать приложение и все его зависимости в единый образ, который можно запускать на любой системе, поддерживающей Docker, что обеспечивает консистентность среды выполнения и упрощает развертывание. Docker помогает ускорить разработку, повысить гибкость и масштабируемость приложений.   
 Материалы: 
 [Основы работы с Docker](https://tproger.ru/translations/how-to-start-using-docker).


1. **Создание FastAPI приложения**:
   Создано в рамках лабораторной работы номер 1

2. **Создание базы данных**:
   Создано в рамках лабораторной работы номер 1

3. **Создание парсера данных**:
   Создано в рамках лабораторной работы номер 2

4. **Реулизуйте возможность вызова парсера по http**
   Для этого можно сделать отдельное приложение FastAPI для парсера или воспользоваться библиотекой socket или подобными.

   Пример кода:
```
from fastapi import FastAPI, HTTPException
...

app = FastAPI()

@app.post("/parse")
def parse(url: str):
    try:
        response = requests.get(url)
        response.raise_for_status()
        # Вызов парсера
        return {"message": "Parsing completed", ...}
    except requests.RequestException as e:
        raise HTTPException(status_code=500, detail=str(e))
```


6. **Разработка Dockerfile**:
   - Необходимо создать Dockerfile для упаковки FastAPI приложения и приложения с паресером. В Dockerfile указать базовый образ, установить необходимые зависимости, скопировать исходные файлы в контейнер и определить команду для запуска приложения.
   - **Зачем**: Docker позволяет упаковать приложение и все его зависимости в единый контейнер, что обеспечивает консистентность среды выполнения и упрощает развертывание.
   - Полезные ссылки:
     - [FastAPI и Docker-контейнеры](https://fastapi.tiangolo.com/ru/deployment/docker/)
     - [Запускаем PostgreSQL в Docker: от простого к сложному](https://habr.com/ru/articles/578744/)
     - [Документация Dockerfile](https://docs.docker.com/engine/reference/builder/)

7. **Создание Docker Compose файла**:
   - Необходимо написать docker-compose.yml для управления оркестром сервисов, включающих FastAPI приложение, базу данных и парсер данных. Определите сервисы, укажите порты и зависимости между сервисами.
   - **Зачем**: Docker Compose упрощает управление несколькими контейнерами, позволяя вам запускать и настраивать все сервисы вашего приложения с помощью одного файла конфигурации.
   - Полезные ссылки:
     - [Зачем нужны системы оркестрации?](https://rebrainme.com/blog/kubernetes/zachem-nuzhny-sistemy-orkestraczii/)
     - [Developing a FastAPI Application in a Docker Container](https://dev.to/abbazs/developing-a-fastapi-application-in-a-docker-container-31n4)
     - [Документация Docker Compose](https://docs.docker.com/compose/)

### Подзадача 2: Вызов парсера из FastAPI

1. ** Эндпоинт в FastAPI для вызова парсера**:
   - Необходимо добавить в FastAPI приложение ендпоинт, который будет принимать запросы с URL для парсинга **от клиента**, отправлять запрос парсеру (запущенному в отдельном контейнере) и возвращать ответ с результатом **клиенту**.
   - **Зачем**: Это позволит интегрировать функциональность парсера в ваше веб-приложение, предоставляя возможность пользователям запускать парсинг через API.
   - Полезные ссылки:
     - [Документация FastAPI](https://fastapi.tiangolo.com/tutorial/path-params/)

### Подзадача 3: Вызов парсера из FastAPI через очередь

### Как это работает

1. **Celery и Redis**:
   - Celery — это асинхронная очередь задач, которая позволяет легко распределять и выполнять задачи в фоне. Redis используется как брокер сообщений, хранящий задачи, которые должны быть выполнены.
   - При получении HTTP-запроса, задача ставится в очередь Redis, и Celery-воркер обрабатывает её в фоне.

2. **Docker Compose**:
   - Docker Compose позволяет легко настроить и запустить Celery, Redis и ваше FastAPI приложение как отдельные контейнеры, работающие в одной сети. Это упрощает управление зависимостями и конфигурацией всех компонентов системы.

### Почему это важно для студентов

Практические навыки настройки и использования асинхронной очереди задач в реальном приложении - **первый шаг для MLops для 45 направления**. Студенты научатся разделять ответственность между различными сервисами и компоновать их для достижения общей цели. В реальных проектах часто требуется выполнение сложных и длительных операций. Опыт работы с Celery и Redis подготовит к решению таких задач и даст уверенность в использовании современных технологий.
 
### Задание

1. **Установить Celery и Redis**:
   - Необходимо добавить зависимости для Celery и Redis в проект. Celery будет использоваться для обработки задач в фоне, а Redis будет выступать в роли брокера задач и хранилища результатов.
   - **Зачем**: Celery и Redis позволяют организовать фоновую обработку задач, что полезно для выполнения длительных или ресурсоемких операций без блокировки основного потока выполнения.
   - Полезные ссылки:
     - [Celery: проясняем неочевидные моменты](https://habr.com/ru/articles/686820/)
     - [Документация Celery](https://docs.celeryproject.org/en/stable/)
     - [Документация Redis](https://redis.io/documentation)

2. **Настроить Celery**:
   - необходимо создать файл конфигурации для Celery. Определть задачу для парсинга URL, которая будет выполняться в фоновом режиме.
   - **Зачем**: Настройка Celery позволит асинхронно обрабатывать задачи, что улучшит производительность и отзывчивость вашего приложения.
   - Полезные ссылки:
     - [Документация Celery: Настройка](https://docs.celeryproject.org/en/stable/userguide/configuration.html)

3. **Обновить Docker Compose файл**:
   - Необходимо добавить сервисы для Redis и Celery worker в docker-compose.yml. Определите зависимости между сервисами, чтобы обеспечить корректную работу оркестра.
   - **Зачем**: Это позволит вам легко управлять всеми сервисами вашего приложения, включая асинхронную обработку задач, с помощью одного файла конфигурации.
   - Полезные ссылки:
     - [Документация Docker Compose](https://docs.docker.com/compose/)

4. **Эндпоинт для асинхронного вызова парсера**:
   - Необходимо добавить в FastAPI приложение маршрут для асинхронного вызова парсера. Маршрут должен принимать запросы с URL для парсинга, ставить задачу в очередь с помощью Celery и возвращать ответ о начале выполнения задачи.
   - **Зачем**: Это позволит запускать парсинг веб-страниц в фоне, что улучшит производительность и пользовательский опыт вашего приложения.
   - Полезные ссылки:
     - [Документация FastAPI: Фоновая задачи](https://fastapi.tiangolo.com/tutorial/background-tasks/)


